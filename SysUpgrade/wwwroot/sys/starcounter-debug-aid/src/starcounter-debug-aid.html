<!--
`starcounter-debug-aid element` - Polymer Elements for debugging Starcounter Puppet web apps

@element starcounter-debug-aid
version: 2.0.5
-->
<!--<link rel="import" href="juicy-error-stacktrace-reporter.html">-->
<!--<link rel="import" href="fast-json-patch-error-reporter.html">-->
<!--<link rel="import" href="juicy-error-dialog.html">-->
<link rel="import" href="../../polymer/polymer.html" />
<link rel="import" href="puppet-js-view-model-tree.html" />
<link rel="import" href="html-imports-list.html" />
<link rel="import" href="puppet-js-settings.html" />
<link rel="import" href="puppet-js-patches.html" />

<dom-module id="starcounter-debug-aid">
    <template>
        <style>
            :host {
                font-family: sans-serif;
                display: block;
                overflow: auto;
            }

            #overlay {
                position: fixed;
                z-index: 9999;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                background: rgba(0, 0, 0, 0.6);
                display: flex;
                justify-content: center;
            }

            #overlay.hidden {
                display: none;
            }

            #dialog {
                width: 90vw;
                margin-top: 5vh;
            }

            .tab-content {
                background: white;
                box-shadow: 0 13px 25px 0 rgba(0, 0, 0, 0.3);
                padding: 4px 4px 4px 4px;
                display: none;
                max-height: calc(90vh - 50px);
            }

            [type=radio] {
                display: none;
            }

            label {
                background: linear-gradient(to bottom, #eee 0%, #ddd 100%);
                padding: 10px;
                display: inline-block;
                margin-right: -0.3em;
            }

            [type=radio]:checked + * + * + * + * + label {
                /* number of asterisks must equal (number_of_tabs - 1) */
                background: white;
            }

            [type=radio]:checked + * + * + * + * + * + * + * + * + * + .tab-content {
                /* number of asterisks must equal (2 * (number_of_tabs - 1)) */
                display: flex;
            }

            html-imports-list {
                width: 100%;
            }

            puppet-js-view-model-tree {
                display: block;
                width: 100%;
                overflow: visible;
            }
        </style>

        <template is="dom-if" if="{{visible}}" restamp>
            <div id="overlay" on-click="onClickOverlay">
                <div id="dialog">

                    <input id="tab1" name="tab-control" type="radio" checked>
                    <input id="tab2" name="tab-control" type="radio">
                    <input id="tab3" name="tab-control" type="radio">
                    <input id="tab4" name="tab-control" type="radio">
                    <input id="tab5" name="tab-control" type="radio">

                    <label for="tab1">View-model</label>
                    <label for="tab2">Patches</label>
                    <label for="tab3">Imports</label>
                    <label for="tab4">Settings</label>
                    <label for="tab5">Help</label>

                    <div class="tab-content">
                        <puppet-js-view-model-tree></puppet-js-view-model-tree>
                    </div>

                    <div class="tab-content">
                        <puppet-js-patches></puppet-js-patches>
                    </div>

                    <div class="tab-content">
                        <html-imports-list></html-imports-list>
                    </div>

                    <div class="tab-content">
                        <puppet-js-settings></puppet-js-settings>
                    </div>

                    <div class="tab-content">
                        <div>
                            <h1>Starcounter Debug Aid</h1>

                            <p>
                                Suggestions and bug reports welcome at <a href="https://github.com/StarcounterSamples/starcounter-debug-aid">
                                    GitHub
                                    Issues
                                </a>.
                            </p>
                        </div>

                        <!-- uncomment with a nice tabbed UI and no errors in Launcher
                        <juicy-error-dialog id="errorDialog" on-error-catched="{{openDialog}}">
                          <template>
                            <fast-json-patch-error-reporter></fast-json-patch-error-reporter>
                            <juicy-error-stacktrace-reporter></juicy-error-stacktrace-reporter>
                          </template>
                        </juicy-error-dialog>-->
                    </div>
                </div>
            </div>
        </template>
        <content></content>
    </template>
    <script>
        Polymer({
            is: "starcounter-debug-aid",
            properties: {
                visible: { type: Boolean, value: false }
            },
            ready: function () {
                var that = this;
                window.addEventListener("keydown", function (ev) {
                    if ((ev.keyCode === 192 || ev.keyCode === 220) && (ev.ctrlKey || ev.metaKey)) { //CTRL+` (Windows) or CMD+ยง (Mac) or CTRL+/ (Windows+Parallels)
                        if (!that.visible) {
                            that.openDialog();
                        } else {
                            that.closeDialog();
                        }
                    } else if (ev.keyCode === 27) { //Esc
                        if (that.visible) {
                            that.closeDialog();
                        }
                    }
                });
                //window.addEventListener("error", this.openDialog.bind(this));
            },
            onClickOverlay: function (ev) {
                if (ev.target === Polymer.dom(this.root).querySelector('#overlay') || ev.target === Polymer.dom(this.root).querySelector('#dialog')) {
                    this.closeDialog();
                }
            },
            closeDialog: function () {
                this.set("visible", false);
                //this.$.errorDialog.reset();
            },
            openDialog: function () {
                this.set("visible", true);
            }
        });
    </script>
</dom-module>
